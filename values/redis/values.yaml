## Redis HA Configuration
## Sử dụng Sentinel cho automatic failover

architecture: replication

## Authentication
auth:
  enabled: true
  sentinel: true
  # Sử dụng existingSecret để không hardcode password
  # existingSecret: redis-secret
  # existingSecretPasswordKey: redis-password
  password: "password"

## Sentinel Configuration
sentinel:
  enabled: true
  masterSet: mymaster
  quorum: 2
  downAfterMilliseconds: 5000
  failoverTimeout: 60000

  resources:
    requests:
      memory: 64Mi
      cpu: 50m
    limits:
      memory: 128Mi
      cpu: 100m

  service:
    type: ClusterIP
    ports:
      sentinel: 26379

## Master Configuration
master:
  count: 1
  
  persistence:
    enabled: true
    size: 1Gi
    storageClass: "standard-rwo"  # GKE storage class
  
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 1Gi
      cpu: 500m

  service:
    type: ClusterIP
    ports:
      redis: 6379

## Replica Configuration
replica:
  replicaCount: 3
  
  persistence:
    enabled: true
    size: 1Gi
    storageClass: "standard-rwo"
  
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 1Gi
      cpu: 500m

  service:
    type: ClusterIP
    ports:
      redis: 6379

  ## Affinity để phân bổ pods trên các nodes khác nhau
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: replica
            topologyKey: kubernetes.io/hostname

## Metrics (optional - bật nếu dùng Prometheus)
metrics:
  enabled: false
  # serviceMonitor:
  #   enabled: true
  #   namespace: monitoring

## Network Policy
networkPolicy:
  enabled: false

## Pod Disruption Budget
pdb:
  create: true
  minAvailable: 1